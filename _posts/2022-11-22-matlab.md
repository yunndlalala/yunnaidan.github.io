---
layout:     post
title:      matlab.engine é…ç½®
subtitle:   ç”¨pythonè°ƒç”¨matlab
date:       2022-11-22
author:     yunnd
header-img: img/2022-11-22-okada/subduction_zone.png
catalog: true
tags:
    - matlab
    - python
    - fortran
    - stress 
---

pythonå¯ä»¥ç›´æ¥ä½¿ç”¨matlabæä¾›çš„APIï¼ˆengineï¼‰è°ƒç”¨matlabä¸­çš„functionï¼Œå®˜æ–¹å®‰è£…æ•™ç¨‹åœ¨[è¿™é‡Œ](https://www.mathworks.com/help/matlab/matlab_external/install-the-matlab-engine-for-python.html)ã€‚
ä½†æ˜¯åœ¨å¤špythonç¯å¢ƒä¸‹çš„Linuxç³»ç»Ÿä¸­é…ç½®çš„è¯ï¼Œmatlab.engineæ€»æ˜¯æœ‰å¾ˆå¤šé—®é¢˜ã€‚
è®°å½•ä¸€ä¸‹å„ç§å‘ï¼š

* * *
+ é¦–å…ˆï¼Œä¸€å®šè¦æ³¨æ„matlabå’Œpythonçš„ç‰ˆæœ¬å¯¹åº”é—®é¢˜ï¼Œåœ¨[è¿™é‡Œ](https://www.mathworks.com/support/requirements/python-compatibility.html)æŸ¥ã€‚ç„¶åå°±æ ¹æ®è‡ªå·±çš„matlab/pythonç‰ˆæœ¬å®‰è£…ç›¸åº”çš„python/matlabç‰ˆæœ¬ã€‚
+ ç„¶åå¼€å§‹installã€‚æ³¨æ„R20222bä¹‹åçš„matlabæ‰å¯ä»¥ç›´æ¥ç”¨pipå®‰è£…ï¼Œå…¶ä»–ç‰ˆæœ¬éƒ½è¦ç”¨setup.pyå®‰è£…ã€‚pipçš„æ²¡æœ‰è¯•è¿‡ï¼Œå°±ä¸è¯´äº†ï¼Œç›´æ¥è¯´æ˜ç”¨setup.pyå®‰è£…çš„æƒ…å†µã€‚æŒ‰ç…§ä¸‹é¢æ­¥éª¤åš
    + åœ¨matlabçš„terminalä¸­è¾“å…¥`matlab`ï¼Œè·å–matlabçš„å®‰è£…è·¯å¾„
    + åœ¨Linuxç³»ç»Ÿçš„terminalè¾“å…¥`cd matlabroot/extern/engines/python`è¿›å…¥è¿™ä¸ªæ–‡ä»¶å¤¹
    + ä¸‹ä¸€æ­¥ï¼Œå¦‚æœç›´æ¥è¾“å…¥`python setup.py install`çš„è¯å°±ä¼šåœ¨é»˜è®¤çš„pythonç¯å¢ƒçš„site-packagesä¸­åˆ›å»ºä¸€ä¸ªmatlab packageçš„æ–‡ä»¶å¤¹ï¼Œä¾‹å¦‚**matlabengineforpython-R2020b-py3.8.egg**ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨pythonçš„terminalè¾“å…¥
      `>>> import sys` 
      `>>> sys.path` 
      çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚è¿™å°±è¯´æ˜é»˜è®¤çš„pythonç¯å¢ƒä¸­å®‰è£…å¥½äº†è¿™ä¸ªmatlab packageã€‚è¿™é‡Œæˆ‘ä»¬ä¸€ç›´åœ¨å¼ºè°ƒé»˜è®¤çš„pythonç¯å¢ƒï¼Œä½†æ˜¯å¦‚æœä½ æœ‰å¾ˆå¤šä¸ªç”±condaç®¡ç†çš„pythonç¯å¢ƒçš„è¯ï¼Œä½ å°±è¦å…ˆè¿›å…¥ç›®æ ‡pythonç¯å¢ƒï¼Œå†è¿è¡Œinstallã€‚

* * *

åˆ°è¿™é‡Œçœ‹ä¼¼å¾ˆé¡ºåˆ©ï¼Œä½†çœŸæ­£çš„bugæ‰å¼€å§‹......
æ³¨æ„ï¼Œç›´æ¥è¿è¡Œ`python setup.py install`æ˜¯éœ€è¦ç®¡ç†å‘˜æƒé™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ ä½œä¸ºä¸€ä¸ªæ™®é€šç”¨æˆ·å°±éœ€è¦`sudo python setup.py install`ï¼Œç„¶åè¾“å…¥å¯†ç ï¼Œè¿™æ˜¯åœ¨ä½ æœ‰ç®¡ç†å‘˜æƒé™çš„æƒ…å†µä¸‹ï¼Œè¿™é‡Œæˆ‘ä»¬å‡è®¾ä½ æœ‰ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œbugçš„æ˜¯é»˜è®¤çš„pythonç¯å¢ƒä¹Ÿä¼šå› ä¸ºsudoè€Œå˜æˆrootçš„é»˜è®¤pythonç¯å¢ƒï¼Œä¸ä½ æœ‰æ²¡æœ‰è¿›å…¥è‡ªå·±æƒ³å®‰è£…matlabçš„pythonç¯å¢ƒæ²¡æœ‰å…³ç³»äº†ã€‚è¿™ç‚¹å¯ä»¥é€šè¿‡è¿è¡Œ`sudo python setup.py install`ä¹‹åç»ˆç«¯çš„è¾“å‡ºçœ‹å‡ºæ¥ï¼Œä½ ä¼šçœ‹åˆ°å¤§æ¦‚æ„æ€æ˜¯matlab packageçš„ç›¸å…³å†…å®¹è¢«å†™è¿›äº†rootçš„é»˜è®¤pythonç¯å¢ƒä¸­çš„è¯­å¥ã€‚
è¿™é‡Œæˆ‘å°±å¡äº†å¥½ä¹…ï¼Œæœ€åç»ˆäºå‘ç°äº†ä¸€ä¸ªå·§å¦™çš„åŠæ³•ã€‚
æˆ‘ä»¬å…ˆactivateåˆ°ç›®æ ‡pythonç¯å¢ƒï¼Œç„¶åsuï¼Œåˆ‡æ¢æˆrootè´¦å·ï¼Œè¿™æ ·å†åœ¨terminalè¾“å…¥pythonï¼Œå°±ä¼šå‘ç°ï¼Œç«Ÿç„¶è¿˜æ˜¯æˆ‘ä»¬çš„ç›®æ ‡pythonç¯å¢ƒï¼Œè¿™æ ·å°±éå¸¸niceäº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦ç»§ç»­è¿è¡Œ`python setup.py install`å°±å¯ä»¥é¡ºåˆ©åœ°å°†matlabä¸‹è½½åˆ°ç›®æ ‡pythonç¯å¢ƒä¸­äº†ã€‚ğŸ‰
ç„¶åæˆ‘å°±å¼€å¿ƒåœ°å»è¯•äº†ä¸€ä¸‹`import matlab.engine`ï¼Œç»“æœ......å‡ºç°äº†ä¸‹é¢çš„errorï¼š
>....../Home/matlab/matlab/bin/glnxa64/../../sys/os/glnxa64/libstdc++.so.6: undefined symbol: __cxa_thread_atexit_impl

å‰é¢å°±çœç•¥äº†å“ˆï¼Œåæ­£ä½ å°±æ˜¯å‡ºç°äº†'__cxa_thread_atexit_impl'è¿™ä¸ªå…³é”®è¯ğŸ˜­ã€‚æœ€åç»è¿‡ä¸€ç•ªæœç´¢ï¼Œç»ˆäºè®©æˆ‘å‘ç°äº†è§£å†³æ–¹æ³•ï¼Œåœ¨[è¿™é‡Œ](https://www.mathworks.com/matlabcentral/answers/868193-segmentation-fault-when-using-matlab-engine-with-rhel-or-centos-linux?s_tid=srchtitle)ã€‚å…·ä½“ä¸ºå•¥å‡ºerroræˆ‘ä¹Ÿæ²¡æ‡‚ï¼Œåæ­£ç…§ç€ä¸Šé¢é“¾æ¥é‡Œé¢çš„åšå°±é¡ºåˆ©è§£å†³äº†ã€‚å·®ä¸å¤šå°±æ˜¯ä¸‹é¢å‡ ä¸ªæ­¥éª¤ï¼š
+ è¿˜æ˜¯åƒå‰é¢ä¸€æ ·å…ˆæ‰¾åˆ°matlabrootè·¯å¾„
+ ç„¶ååœ¨terminalè¾“å…¥`ls matlabroot/bin/glnxa64/glibc-*`ï¼Œè®°ä½è¿™ä¸ªè¾“å‡ºï¼Œæ¯”å¦‚è¯´æ˜¯`matlabroot/bin/glnxa64/glibc-2.17_shim.so`
+ ç„¶ååœ¨terminalè¾“å…¥echo $0
    + å¦‚æœè¾“å‡ºç»“æœæ˜¯csh/tcshï¼Œå°±åœ¨terminal
    `setenv LD_PRELOAD matlabroot/bin/glnxa64/glibc-2.17_shim.so`
    + å¦‚æœè¾“å‡ºç»“æœæ˜¯bashï¼Œå°±åœ¨terminal
    `export LD_PRELOAD=matlabroot/bin/glnxa64/glibc-2.17_shim.so`

* * *
ç°åœ¨ç»ˆäºå¯ä»¥äº†ï¼Œå†å»`import matlab.engine`å°±æ²¡æœ‰é—®é¢˜å•¦ï¼
